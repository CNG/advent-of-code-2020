#!/usr/bin/env python
from collections import Counter
import doctest
import logging
import math
import sys

log = logging.getLogger(__name__).debug


# Part One


def part_one():
    print("Part One")
    corner_ids = [int(t.name) for t in corners(parsed_tiles(data[0]))]
    assert 20899048083289 == math.prod(corner_ids)
    corner_ids = [int(t.name) for t in corners(parsed_tiles(data[1]))]
    # print(len(corner_ids))
    print(math.prod(corner_ids))


def print_puzzle(tiles):
    rows = int(len(tiles) ** 0.5)
    for x in range(rows):
        for y in range(len(tiles[0].content)):
            if y == 0:
                for tile in tiles[x * rows : (x + 1) * rows]:
                    print(tile.name.ljust(len(tiles[0].content)), end=" ")
                print()
            for tile in tiles[x * rows : (x + 1) * rows]:
                print(tile.content[y], end=" ")
            print()
        print()


def corners(tiles):
    log(f"We have {len(tiles)} tiles")

    # def borders(tiles):
    #     return [border for tile in tiles for border in tile.borders]

    def all_borders(tiles):
        return [border for tile in tiles for border in tile.all_borders]

    def num_matching_borders(tiles, tile):
        return sum(
            1
            for border in tile.borders
            for t in tiles
            for b in t.all_borders
            if t.name != tile.name
            if b == border
        )

    for tile in tiles:
        log(f"Tile {tile.name}: {num_matching_borders(tiles, tile)}")
        if 2 == num_matching_borders(tiles, tile):
            yield tile

    # print_puzzle(tiles)


class Tile:
    def __init__(self, data):
        name, content = data.split(":\n")
        self.name = name.strip("Tile ")
        self.content = [line for line in content.splitlines()]

        self.borders = []
        for _ in range(4):
            self.borders.append(self.content[0])
            self.rotate()

        # Only used for Part One
        self.flipped_borders = []
        self.flip()
        for _ in range(4):
            self.borders.append(self.content[0])
            self.rotate()
        self.flip()
        self.all_borders = self.borders + self.flipped_borders

    def flip(self):  # vertically
        self.content = self.content[::-1]
        self.borders, self.flipped_borders = self.flipped_borders, self.borders

    def rotate(self, count=1):  # clockwise
        for _ in range(count):
            self.content = list("".join(z) for z in zip(*self.content[::-1]))
            self.borders = [self.borders[-1]] + self.borders[:-1]
        return self.content

    def __str__(self):
        return "\n".join(self.content)


def parsed_tiles(data, cls=Tile):
    return [cls(tile) for tile in data.split("\n\n")]


# Part Two


def part_two():
    print("Part Two")

    # mt = MegaTile(*parsed_tiles(data[0], Tile2))
    # print(mt)
    # merged = Tile2(f":\n{mt}")
    # print(merged.monsters())
    # print(merged.roughness())
    assert (
        273 == Tile2(":\n" + str(MegaTile(*parsed_tiles(data[0], Tile2)))).roughness()
    )
    print(Tile2(":\n" + str(MegaTile(*parsed_tiles(data[1], Tile2)))).roughness())


class Tile2(Tile):
    monster = [
        "                  # ",
        "#    ##    ##    ###",
        " #  #  #  #  #  #   ",
    ]

    def __init__(self, data):
        name, content = data.split(":\n")
        self.name = name.strip("Tile ")
        self.content = [line for line in content.splitlines()]
        # super().__init__(data)
        self.state = 0

    def mutate(self):
        self.state += 1
        if self.state % 4 == 0:
            self.flip()
        else:
            self.rotate()
        if self.state == 8:
            self.state == 0

    def border(self, num=0):
        "0 = top, 1 = right, 2 = bottom, 3 = left"
        if num == 0:
            return self.content[0]
        elif num == 1:
            return "".join(row[-1] for row in self.content)
        elif num == 2:
            return self.content[-1]
        elif num == 3:
            return "".join(row[0] for row in self.content)

    def flip(self):  # vertically
        self.content = self.content[::-1]

    def rotate(self, count=1):  # clockwise
        for _ in range(count):
            self.content = list("".join(z) for z in zip(*self.content[::-1]))
        return self.content

    def monsters(self):
        def match(square, monster):
            for y in range(len(monster)):
                for x, char in enumerate(monster[y]):
                    if char == "#" and square[y][x] != "#":
                        return False
            return True

        def count_monsters():
            monster = self.monster
            self.mutate()
            monsters = 0
            for y in range(len(self.content) - len(monster) + 1):
                for x in range(len(self.content[0]) - len(monster[0]) + 1):
                    square = [
                        self.content[y + 0][x : x + len(monster[0])],
                        self.content[y + 1][x : x + len(monster[0])],
                        self.content[y + 2][x : x + len(monster[0])],
                    ]
                    if match(square, monster):
                        monsters += 1
            return monsters

        return max(count_monsters() for _ in range(8))

    def roughness(self):
        monsters = self.monsters()
        return (
            Counter("".join(self.content))["#"]
            - monsters * Counter("".join(self.monster))["#"]
        )


def touching(coords):
    x, y = coords
    yield x + 1, y
    yield x - 1, y
    yield x, y + 1
    yield x, y - 1


def match(spot_1, tile_1, spot_2, tile_2):
    # log(f"{spot_1}, {tile_1.name}, {spot_2}, {tile_2.name}")
    # log(f"\n{tile_1}\n\n{tile_2}\n")
    x1, y1 = spot_1
    x2, y2 = spot_2
    b1 = b2 = None
    if y1 == y2:
        if x2 == x1 - 1:  # tile 2 : tile 1
            b1 = tile_1.border(3)
            b2 = tile_2.border(1)
        elif x1 == x2 - 1:  # tile 1 : tile 2
            b1 = tile_1.border(1)
            b2 = tile_2.border(3)
    elif x1 == x2:
        if y2 == y1 - 1:  # tile 1 above tile 2
            b1 = tile_1.border(2)
            b2 = tile_2.border(0)
        elif y1 == y2 - 1:  # tile 2 above tile 1
            b1 = tile_1.border(0)
            b2 = tile_2.border(2)
    if b1:
        # log(f"checking borders {b1} and {b2}")
        return b1 == b2
    else:
        raise Exception("Tried to match non-touching spots. (1)")


class MegaTile:
    def __init__(self, *tiles):
        self.tiles = {}
        while len(tiles):
            redos = []
            for tile in tiles:
                log(f"Working on tile {tile.name}")
                if not self.add(tile):
                    redos.append(tile)
            tiles = redos

    def add(self, tile):
        used_spots = self.tiles.keys()
        if not used_spots:  # Special case adding first tile at 0, 0
            self.tiles[(0, 0)] = tile
            return True
        open_spots = set(
            neighbor
            for used_spot in used_spots
            for neighbor in touching(used_spot)
            if neighbor not in used_spots
        )
        log(f"used spots: {used_spots} -- open spots: {open_spots}")
        spot = None
        for spot in open_spots:
            log(f"trying open spot {spot} with Tile {tile.name}")
            self.tiles[spot] = tile
            for _ in range(8):
                log(f"Testing position {_}")
                if self.valid():
                    log(f"VALID!!")
                    break
                else:
                    tile.mutate()
            else:
                log(f"No match, deleting {tile.name} from {spot}")
                del self.tiles[spot]
            if spot in self.tiles:
                log("Tile wasn't removed because must be valid; stop trying positions.")
                break
        # confirm no bugs...
        if spot in self.tiles and self.tiles[spot] == tile:
            log(f"Added tile {tile.name} to spot {spot}.")
            return True
        else:
            log(f"FAILED adding tile {tile.name}")
            return False

    def valid(self):
        used_spots = self.tiles.keys()
        checked_pairs = set()
        for spot, tile in self.tiles.items():
            for neighboring_spot in touching(spot):
                pair = tuple(sorted((spot, neighboring_spot)))
                if neighboring_spot in used_spots and pair not in checked_pairs:
                    if match(
                        spot, tile, neighboring_spot, self.tiles[neighboring_spot]
                    ):
                        checked_pairs.add(pair)
                    else:
                        return False
        return True

    def __str__(self):
        result = ""
        tiles = list(
            tile
            for spot, tile in sorted(
                self.tiles.items(), key=lambda kv: (-kv[0][1], kv[0][0])
            )
        )
        rows = int(len(tiles) ** 0.5)
        for x in range(rows):
            for y in range(len(tiles[0].content)):
                if y == 0 or y + 1 == len(tiles[0].content):
                    continue
                for tile in tiles[x * rows : (x + 1) * rows]:
                    result += tile.content[y][1:-1]
                result += "\n"
        return result

    def print(self):
        tiles = list(
            tile
            for spot, tile in sorted(
                self.tiles.items(), key=lambda kv: (-kv[0][1], kv[0][0])
            )
        )
        print_puzzle(tiles)


# Data

data = []
data.append(
    """Tile 2311:
..##.#..#.
##..#.....
#...##..#.
####.#...#
##.##.###.
##...#.###
.#.#.#..##
..#....#..
###...#.#.
..###..###

Tile 1951:
#.##...##.
#.####...#
.....#..##
#...######
.##.#....#
.###.#####
###.##.##.
.###....#.
..#.#..#.#
#...##.#..

Tile 1171:
####...##.
#..##.#..#
##.#..#.#.
.###.####.
..###.####
.##....##.
.#...####.
#.##.####.
####..#...
.....##...

Tile 1427:
###.##.#..
.#..#.##..
.#.##.#..#
#.#.#.##.#
....#...##
...##..##.
...#.#####
.#.####.#.
..#..###.#
..##.#..#.

Tile 1489:
##.#.#....
..##...#..
.##..##...
..#...#...
#####...#.
#..#.#.#.#
...#.#.#..
##.#...##.
..##.##.##
###.##.#..

Tile 2473:
#....####.
#..#.##...
#.##..#...
######.#.#
.#...#.#.#
.#########
.###.#..#.
########.#
##...##.#.
..###.#.#.

Tile 2971:
..#.#....#
#...###...
#.#.###...
##.##..#..
.#####..##
.#..####.#
#..#.#..#.
..####.###
..#.#.###.
...#.#.#.#

Tile 2729:
...#.#.#.#
####.#....
..#.#.....
....#..#.#
.##..##.#.
.#.####...
####.#.#..
##.####...
##..#.##..
#.##...##.

Tile 3079:
#.#.#####.
.#..######
..#.......
######....
####.#..#.
.#...#.##.
#.#####.##
..#.###...
..#.......
..#.###..."""
)
data.append(
    """Tile 2141:
#.#...#...
###..#...#
.....##...
..#.##..#.
.#....#..#
...#######
.....#...#
#.#......#
##........
########.#

Tile 3467:
..#.#....#
#.....#..#
....#....#
...#......
#.#....###
.#....#..#
#.........
.....#...#
.##...#...
##.#..#.#.

Tile 3389:
......##..
.##...#...
.#..###...
....##.#..
#..#.#....
.#.##..#..
#....##...
.#...#..##
..##.#...#
####..#..#

Tile 2797:
#..###..##
#.........
#.........
##.#....#.
.........#
.#...#...#
.........#
..#.#....#
..#...##..
...##..##.

Tile 1321:
.#....#..#
......#..#
#.#......#
#..#.#...#
.........#
.#..##....
...#.....#
#....#..#.
..##.##...
##.###.###

Tile 2741:
..#.#.####
#......##.
#.#...#.##
.##......#
..#.#....#
.#.#.....#
#........#
..#......#
#...#....#
...#..#..#

Tile 3169:
.##.#.#...
#.#..#...#
#...###...
..#...##..
.#..#.#.##
..#.......
...#......
.......#..
#.#.......
#.#.##..##

Tile 1097:
.##.#..#..
..#...##..
###.#.#...
..#..##...
......##.#
...#..#..#
#.#..#..##
.##.#...#.
##.#..#...
##..#...##

Tile 3457:
#.#.#.####
..#.#.#...
..#.......
##.....#..
#........#
.......#.#
#........#
#.......##
#..#.#..##
.##.##.#..

Tile 1471:
##.#.#.##.
..........
...#...#.#
#...#...#.
.....#..##
.......#.#
........##
...#...#.#
.#....####
.#.##.##.#

Tile 1531:
#....#..#.
#.#....#..
.......#..
.##.####.#
#..#.##..#
#........#
##.#.#...#
#...#....#
..........
...##..###

Tile 1523:
##..##.##.
...#..##..
#....#.#..
....#.####
#.#....#.#
....##..#.
#..#....#.
#..#..##.#
..#...##..
.#..####..

Tile 1447:
.#..#...##
.........#
..........
#.#....#.#
..#....##.
#......#.#
#.....#..#
#......#.#
..........
######....

Tile 2179:
#..#...#.#
..#......#
........#.
#.....#..#
......##..
#..#.##..#
#.##..#.#.
###.#..##.
...#..#..#
#.##..#.#.

Tile 1789:
#.#.#.##.#
#..#.#....
.#.#......
#.#....#..
##..#...#.
##..#....#
#.###.....
#..#.#.#..
#.......#.
#.##..####

Tile 2521:
.###..##..
..#.##....
##.#.....#
..##...#.#
#.###.#..#
.........#
.........#
#.........
.....#.#.#
.#....#.#.

Tile 3583:
..#..#.#..
..#.....##
#......#..
.........#
#...##.#.#
..#..#....
....#....#
#..#..#..#
#..#..###.
##...#.#.#

Tile 2633:
..#..#...#
..........
#..###..##
###......#
..#...#..#
#.###..###
##..#.##..
###.#.#..#
#....#....
#.#.######

Tile 1667:
###.##..#.
........#.
..#...##.#
........#.
#..##....#
#.#..#..##
.##......#
..#.......
#..#..#..#
.###..##.#

Tile 2003:
......#...
#.#.......
#..#......
#.....#..#
##.......#
.....##.##
#.###.....
#..#.#...#
......#...
#.##...#..

Tile 1103:
###.######
...######.
........#.
#....##..#
#.....#..#
#....#....
#..##..#.#
...##....#
#......#..
##...#.#.#

Tile 3167:
..##...##.
##.......#
...#...#.#
.......#..
.........#
........#.
##.......#
##.#.....#
..#.#.....
.#.####.##

Tile 1031:
#.##....##
#.#..#...#
#...#.....
#.#.......
#.#..##...
#...#....#
##..#....#
.#.#.....#
#.......##
...#####.#

Tile 2539:
##...#..##
..#....#..
......#..#
#...###..#
...#...#..
##....####
#.......##
#......#.#
.........#
.##.#..###

Tile 1871:
.#..#.#.##
...###...#
.........#
#...##....
...###...#
###.#..#.#
#..##....#
##.....#..
#....#..##
#####.##..

Tile 2383:
.#.....###
#.#.......
#.....#..#
.#...##..#
...#...#.#
#....#.#.#
...#....##
##.#..####
...#.....#
###.##.#..

Tile 1237:
##.#.#.##.
.##...####
#...#..#..
##.#..#.#.
##....#.#.
....#..###
....#....#
#.......##
..##...#.#
#.#..#..##

Tile 1093:
..##.###..
....###...
#..#.#....
#.........
..........
..#....#.#
#.....#...
........#.
......##.#
.#...#..##

Tile 1583:
..###.#..#
.........#
......##..
#....#..##
.###...###
..##..#.#.
....##.#.#
#.....#.#.
##.......#
#.#.##..#.

Tile 2243:
..#..#####
...#....##
#.....#..#
#......#.#
..#.#..#.#
.#...#...#
##.....#..
##.##.###.
#........#
#..#...#.#

Tile 1297:
..#......#
##..#.....
.##.#.....
.....##..#
.#....##..
#.#.#...##
.#........
.##.##.#.#
..#.###..#
#..#...#..

Tile 1877:
....###.#.
#....#....
.##...#..#
.........#
.........#
.#..##.#..
...#.....#
#.....#..#
...##.....
#.#.#.#...

Tile 3779:
.#...##..#
.#.......#
#.........
#.......##
.....#...#
.........#
...#.#...#
#.........
..#..#.###
#.#####.#.

Tile 2029:
....##..##
#..###...#
.....#..##
#...#.#...
##..###..#
#.#..##.#.
.......#.#
..##..#..#
..#....#.#
.##..#####

Tile 3221:
.#..#..##.
.###..#...
....#.##..
#.#.#.#.#.
#..#...#..
..........
#.#.....##
###....#.#
..###...#.
#......#..

Tile 3463:
.#.#......
#...#..#..
......#..#
#..#.##..#
#.....#..#
.#..###.#.
#####...#.
#.#....#..
#.........
##.###.#.#

Tile 3331:
##.###..##
##..#..#..
.....##...
..#...#.#.
#..#.#...#
...###....
.........#
.###....##
#...####.#
..#.##....

Tile 2473:
..####.#.#
##.#....##
......#.##
##.......#
##...##..#
##....#..#
.#.#.#....
......##.#
..#.##....
#..###...#

Tile 2459:
##.##....#
..........
#.#....###
#.........
##....##.#
...#......
###.......
..........
#.....#...
.#.###.#.#

Tile 3877:
...#.#.#..
#....#...#
.#......#.
......##.#
....#.##.#
.#.#..#.##
##........
....#.####
###...#.##
######..##

Tile 2161:
..##...#..
#....#...#
#.#.#.#..#
.##....###
...#..#...
#.........
.##....##.
.........#
#........#
.#.#.###..

Tile 3361:
#..##.....
.##.....#.
#........#
#..#......
#.........
##...##..#
..#..#....
#.#.......
...#.....#
###.#.##..

Tile 2089:
.##.####.#
...#....##
.###.#.#..
.........#
..#.##..#.
.###..##..
..........
...##.#..#
#..#....##
#...####.#

Tile 2711:
.##.#..###
#.#.....##
#..###.#.#
.##.....##
...#....#.
##......#.
#........#
..#.......
###..#.#.#
...#.##..#

Tile 1753:
....##.###
#........#
#...#...#.
..##.#....
#..#..#.##
#.....#..#
#.........
...#......
##.....#..
##..#.....

Tile 2953:
.#.####..#
...#.....#
.##.....##
#...#.....
##........
###.#..#.#
#..#.##...
#..#...#..
#.#......#
..#.#...#.

Tile 3593:
#..#.#..#.
#.#.....#.
#.#.......
#..#.....#
...#..#...
#........#
#....#.#.#
#..#......
..#......#
...#..#.##

Tile 1483:
..#.####..
.#.......#
##........
.......#..
##..#....#
#........#
..#...#...
#.........
###....#..
..#.#..##.

Tile 1657:
#####..##.
.###....#.
...#...#.#
#..#....#.
#.#...#.#.
.....##.##
.......#.#
####......
#..##....#
..#...#..#

Tile 3307:
.#..##.###
....#..#..
###..#..##
#.###.....
..###....#
#..#...#.#
.........#
....#.###.
..#......#
#.##.#.###

Tile 3617:
...#.#.#..
..........
.#....#.##
.#.#...#..
.#.....#..
.##.#..###
#..#......
#......#..
.#..#...#.
#.##..#..#

Tile 3001:
##...#####
..##.....#
#.....#.##
##........
....#.....
#....#..#.
...##.#...
.......#.#
#.....#..#
#.####....

Tile 1013:
.##..#....
#....##...
#...#...##
.#.###...#
....#..#..
##...#..#.
..#....#..
#...#..#.#
...#.....#
####.#####

Tile 2801:
#...##.##.
#.....#...
......#...
#....#...#
...##.....
.#......#.
....##..##
#....#####
....##...#
..#..###..

Tile 3079:
..##.#...#
#.....#...
...#.....#
..#..#...#
#..#...###
#.##......
#.###.....
#........#
#.....#.#.
..#.#...#.

Tile 1231:
####.#####
..#.#....#
.#....#...
.#..#....#
..#......#
#..#.###.#
.#.......#
#.##...#.#
.....#.###
.###.###.#

Tile 1171:
..#..#..##
#...#....#
#....#...#
#.........
###......#
#...#..#..
..#..#.#..
...#...#..
.....#....
###..#.###

Tile 3319:
###.#####.
..........
..##......
#.......#.
#..#.#..#.
.#.##.....
..###..#.#
#...#...##
##.#.#....
...##...##

Tile 2129:
##...#.###
#........#
.....#...#
##.......#
#.#.#.#...
......#...
#....#..#.
..........
.......#.#
.###.###.#

Tile 3371:
.##.......
#....#.#.#
..#.#...##
#.........
.#.....#..
#.....#.##
...#......
##....#...
..#..##..#
#..#.#####

Tile 1129:
#.##..#.#.
#......###
#.#....#..
.####...##
#...#..#.#
#..#......
.##.....##
#..#.....#
..........
#.###..#..

Tile 1399:
#.....#.##
#........#
.....##...
........##
...#...#..
#.###..##.
#..#.#.#.#
....##.#.#
#.##.....#
.#..###.##

Tile 2503:
#...#...##
#..#.#....
.....#.#.#
...#.....#
..#......#
..##.....#
.....#....
...#...#.#
.#........
#.###...#.

Tile 3529:
.##...####
.#.....###
#..#..##..
....##.#.#
.......##.
#........#
.........#
#.##......
##....#..#
....#.##.#

Tile 1181:
.#.##.#.##
#..#......
#........#
..##......
##.#...#.#
.#.##..#.#
##........
#..#..#..#
#.#...#..#
..#.#.##..

Tile 1759:
...#..#..#
..#...#...
##....#...
#.#..#.#..
#.......##
#...#...##
##......#.
##...#.###
##...#....
.##...#...

Tile 2543:
######.###
####....##
##.#..#.#.
##...#....
..........
..#......#
#.......##
##........
..###..##.
##....####

Tile 3613:
.##..#....
......#..#
#.........
....##...#
....#....#
.#..#.....
....##...#
#.#..#..#.
#..#.....#
##.##...##

Tile 3853:
....######
.####....#
..###.....
#.#.......
#..#..#...
....#...##
##....##.#
#..##..#..
#.#..#...#
..#######.

Tile 3187:
.#..#.####
#.##....#.
.....#....
##....#...
.#.##.#...
#...##...#
#....#...#
......#...
#....#..#.
#..###....

Tile 2437:
#..#.##.#.
##...###.#
.....#....
.#......#.
...##.#...
#..###...#
#....#....
.#....#..#
..........
.##.#.#..#

Tile 2917:
#.....#...
.#.#...#..
#.##.##..#
......#..#
...###....
##.#......
....#....#
###.....##
.#.#....##
####.#..##

Tile 1511:
#...###.#.
..##.#..##
..#...#...
##.#..#.##
##....#..#
#.........
#........#
........#.
#.....##.#
.#.....##.

Tile 2699:
.#.#......
#........#
..##...#..
......##..
..##..#..#
#.###..#.#
#.#..#...#
#.##.....#
..###.....
###..##.##

Tile 3259:
###.###..#
.........#
#.#.....#.
...#..#...
.##....###
##.......#
...#.#...#
...##...##
#.........
......#...

Tile 1429:
....##.##.
.###...#..
##.#...###
#.........
#....#...#
#.....#...
...#.##...
#.......##
.#......##
###.#.##..

Tile 2039:
#....###.#
.#..#.#..#
#.#.#...#.
..#.......
##...#..##
#.#.......
#......##.
..#....#.#
#.#.......
..####.#..

Tile 3637:
#.###.#.##
#......###
#.........
.....#...#
..#..#.##.
#..#....#.
........#.
..#.......
...#......
...#.###.#

Tile 1163:
##.###.##.
#.##.#....
..#.#.....
#..####.#.
#..#......
#......#.#
.#........
.#.##.....
#.##....##
##.#......

Tile 3761:
...##.###.
.........#
....#.....
##.......#
#.......#.
...##.....
#.#.......
.........#
#.#......#
.##.###...

Tile 1777:
##...##.##
....#.....
.#...#....
#....#.#.#
..#.#....#
#....###.#
##...#....
#...###..#
#...##..#.
......#.##

Tile 2857:
.#..#.##..
#..#.....#
##........
...#.#..#.
.##..#..#.
#####.##.#
#..##.....
##...#.#.#
#...#.....
...##.##.#

Tile 3061:
.#.#.###.#
#........#
.###.###..
..##.....#
#...#....#
#.#.#..###
.##......#
.....##...
....#.....
.#..#..#..

Tile 1721:
..#..#####
.#....###.
#..#...#..
#.........
#....#...#
...##..##.
#........#
#......#..
#.........
....##.###

Tile 2693:
.....#.#..
.#......#.
.#.....#.#
#....##..#
#..#......
####.##..#
#.#.....#.
..........
#.#....#.#
#.##..#...

Tile 1259:
#...#..###
#...#...##
##..#.#..#
#.#.......
#......#.#
###.......
#...#.....
...#.....#
.#...#...#
.#...##.##

Tile 1291:
#..##.#...
#.....##.#
.#..#....#
#...#...#.
..###.#...
###......#
#..#...#.#
#....#....
..##......
#..#..#.#.

Tile 1051:
#...####.#
##..#.....
.........#
.#..#..#..
##...#..##
...##....#
##........
.#......#.
...#.....#
###.###..#

Tile 2719:
.#.##..##.
.#.....#..
#.....#...
##.#.....#
#######...
##...##.#.
......##..
........##
..#....###
#..#..#.##

Tile 3533:
...##....#
##.......#
#....#....
....##...#
.....##.##
....#..##.
#.........
###...#.#.
#.........
#..####...

Tile 2659:
.##.#...#.
.#..#...#.
....#...##
.#..#.#..#
#.##.##..#
..##.....#
..#..#..##
..#.......
.........#
#....####.

Tile 3517:
#..##.#.#.
.#...#...#
.#.#.....#
##.......#
..#.......
#......#..
.........#
...##...#.
......#.##
..##...#..

Tile 2371:
###.##.##.
.#.#.##..#
.....#...#
#.#.#..#.#
####...#.#
#.#.#.##..
..#.#.....
##........
..#..#...#
#...#.###.

Tile 1601:
.####..##.
#.........
......#...
#.#..##.#.
..##.#.#.#
#.......#.
#..#.....#
#.....#.#.
..###....#
.#..######

Tile 2273:
..###.###.
....#.....
.##...#...
#.#...#...
....#.....
.#.....#.#
.#......#.
.#.#..#...
........##
##..###...

Tile 3917:
####.#...#
#...#...##
#.##...###
#..#...##.
....#....#
.........#
......#..#
###.#.#...
...##...##
#..#####.#

Tile 3701:
#..###...#
###..#...#
#.#...##.#
.##.#.#..#
.##..#..##
##..#.#...
.##.#.#.##
....##.#..
#.....#...
..##.##.#.

Tile 2081:
...####.#.
........##
#.#...#..#
.###...##.
#..#.##...
#....#....
#.#..###..
........##
..#......#
...##..###

Tile 2339:
#.#..#..##
.#..#...#.
........##
.##....#..
#.....#.#.
........#.
....#...##
.#....##..
#........#
#.##.#...#

Tile 1373:
###.###...
.........#
#......###
#...##...#
.###....#.
#..#.....#
..........
##..#..#.#
.###.#..##
###...##..

Tile 2837:
##....#...
...#...#.#
#.........
..#.......
##.#......
.#....#...
.###....#.
##......##
.....#....
.#.##.....

Tile 3803:
#..#..##..
.......#..
##.###....
#.#.#.#...
....##....
#.###..#.#
....#...##
........#.
..##.....#
..#..###..

Tile 3559:
#....##.##
...##.....
..#..#...#
#........#
##........
#.#.......
#.#..#.#.#
#....#..#.
#...#.....
##.#.#....

Tile 1549:
####.##.#.
......#...
#..#.#..##
#..#..#.#.
.#.....#.#
.........#
.........#
#....#...#
#.......#.
#####....#

Tile 1699:
.#.##.#.#.
.#..####..
.#.#......
.###..##.#
#........#
##.#......
.#.#.##..#
#.#..#....
#.......#.
.###.##..#

Tile 2647:
###.......
.......#.#
..#.#...#.
#..#...#..
..##......
#.#.#....#
....#.#.#.
#.........
#...#.....
#.###...##

Tile 1361:
...##.#.#.
..........
#.........
#.#....#..
##..##...#
....#.....
#.......#.
..........
#.##.#.#..
#..##.#.##

Tile 3851:
##........
...##.#...
....#.....
....####..
#.....#..#
#...#.##.#
#..#.....#
...#..##.#
#.#....#..
#..####...

Tile 3911:
##..##.##.
#.#.....##
...#.#...#
.....#....
.#...#..#.
...##.##..
#.#.#.####
.......#.#
...#.#....
##..#.##.#

Tile 3719:
##.##.###.
....#..#..
...#......
#......###
.#.#....##
..###...#.
....#..#.#
..........
#..#....#.
#####..###

Tile 2239:
###.##.##.
###......#
#.##.#..#.
..#....#..
......##..
.....#..#.
...#......
#.........
..........
.#.....###

Tile 1249:
#.#..####.
...#.....#
....#....#
.........#
.#.##...##
..#.####.#
...###....
#.........
#.....#...
.#..#.#...

Tile 2707:
.##.#.....
#.....##.#
.#..#...##
...#.#.#..
..#.......
.#.#...#..
#.....#...
#.##......
.#........
.###.#..##

Tile 2897:
..###...#.
...#..#..#
#......#..
#..#.....#
.....#....
..##..####
#...##...#
#.#......#
##......##
......#..#

Tile 3623:
#..#.....#
##.#...##.
##.......#
#.#....#.#
.#....#..#
#.##..#...
.##....#.#
.#.......#
#.#.#..#.#
#..#.###.#

Tile 2617:
.######...
#..#.....#
..........
#####....#
....#....#
##.###..##
......##..
.....##..#
#.........
...####.#.

Tile 1049:
..#.##...#
.#.....#.#
......#..#
#####.#...
......#...
....#.....
#.........
#.........
##.......#
..#..#.#.#

Tile 3019:
##.##..#..
##...#..##
...#....#.
..........
...#......
#...#...#.
####.##.#.
###......#
.....#....
######...#

Tile 3067:
#...#.#..#
#.#.##...#
....#.#..#
##.#......
....###..#
.#.....#..
.#.......#
......#..#
##.#.....#
.#####.###

Tile 3203:
#...###.##
#.#......#
..#..#..#.
.##...##.#
#.....###.
...##....#
#......#.#
.#........
.#.#....##
##.#####.#

Tile 2113:
.#.#.#..#.
#...#.....
###.....##
#.###.....
##........
#...##....
......####
......#..#
#..###.##.
..#.###.##

Tile 2591:
##..###...
........##
#........#
.....##..#
.........#
..#...#...
....#..#.#
#......#..
...#......
.##.##.#.#

Tile 1499:
.....##..#
...#......
.##.....#.
......##.#
.#........
#..##.#...
....##...#
#........#
....#.....
.#.##.#..#

Tile 3413:
#..#..##..
.#..#..###
#..#....##
##.......#
#.###.....
#....#..##
#........#
.....#...#
#...#....#
#.#..#..#.

Tile 3923:
.#...#####
#..####...
#.##....#.
#....##..#
#.#...##.#
..#..#....
#.#......#
.#..#..#.#
#.##....#.
###.###...

Tile 3527:
#.##...###
#......##.
#..#..#..#
....#....#
#.....#.##
..........
#........#
#..#.#...#
.##..#...#
#.#.##.###

Tile 2957:
###.#...#.
#.#..#....
...#.....#
#.#......#
.##.....#.
.........#
....#.....
#......#.#
...#......
#..##.##..

Tile 1481:
##....#...
...#...#.#
#.##......
.......#..
.#..#..#.#
.....###.#
#.........
.......##.
......#...
..###....#

Tile 1747:
###..#####
..#.##....
##.......#
.#........
#.##.....#
...#......
#........#
#.##...#.#
####......
##.##...#.

Tile 3659:
.##.###...
##..##.##.
####..#.##
....##.###
#.........
.##.#.#..#
.#...#..##
..####.##.
#..#..#...
..###...#.

Tile 2621:
#####....#
...#....#.
.##......#
..###....#
...#..#...
.........#
#.........
.#..#..#..
.#...##...
#......#.#

Tile 2927:
.#..####..
......#.##
.......#.#
#...#.##.#
##...#..##
#.....##.#
#.......#.
##........
#.....#...
##.#.##...

Tile 3727:
..#.....#.
#........#
####..#..#
##.#....##
...#......
###....#..
#..##..#.#
#.#.#...##
#...#.....
.####.##.#

Tile 2803:
##.##..###
#....###.#
#.....##..
#.#...#...
.#.#......
#...##..##
......#...
##.....#.#
.##.#..##.
..##.##...

Tile 2593:
.##.#....#
#.#.#.#...
#.......##
..........
...####...
....##....
#...##.#.#
#...##..##
.##......#
##....##.#

Tile 3109:
.###.#..##
#.........
.#...#..##
##...#...#
#..#....#.
#.........
#........#
#.##..#...
.#.......#
#.#####..#

Tile 3797:
#...##.##.
.....#..#.
##..##.#..
#........#
.#...#....
##..#.#...
##....#...
###.##...#
#......#.#
##.###..#.

Tile 1367:
##.#..##.#
..#.......
.#.......#
...#..##..
.##....##.
#..#.##..#
..#...#..#
#.#......#
#..#....##
...##..#..

Tile 2309:
##.#.####.
..###.....
...#....##
..#....#..
.#....#..#
##....#..#
..#......#
..##..##.#
.....###.#
#..##.##.#

Tile 2087:
.#.#.#.#.#
#.##....#.
#..#....#.
...#......
#.......##
...#..#...
#...###..#
.#....#..#
.#.###...#
.#.#######

Tile 2441:
....####.#
.........#
#.....##..
.#..##.#.#
####.#..##
#.#.....#.
#.#.#.##.#
....#...##
###..###.#
.#.....##.

Tile 3643:
##.#...###
..##....##
.....#....
#.#.#.#...
...#.#.#..
....##....
....##....
#.....##.#
#.......##
.......##.

Tile 3251:
##...#.#..
.#.......#
.#....##..
..#.....##
.#.#......
..#..##.##
.##..###.#
....#....#
##..##...#
#.#..###.#

Tile 1787:
#.#.#..#.#
..........
..#......#
..........
.#......#.
..#....#..
........#.
##....#..#
..##......
###.#...#."""
)


if __name__ == "__main__":

    def main(part=None):
        if not part or part == 1:
            part_one()
        if not part or part == 2:
            part_two()

    doctest.testmod(verbose=False)
    if len(sys.argv) > 1:
        if len(sys.argv) > 2 and sys.argv[2] in ("-v", "--verbose"):
            logging.basicConfig(format="%(message)s", level=logging.DEBUG)
        main(part=int(sys.argv[1]))
    else:
        main()()
